try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="da10e217-da56-4640-9877-a6d417a7b865",e._sentryDebugIdIdentifier="sentry-dbid-da10e217-da56-4640-9877-a6d417a7b865")}catch(d){}import{_ as e,u as t,T as i,b as s,g as r,r as n}from"./index-OdOCjMiI.js";import{n as a,a as o}from"./nav-Ck_lkINx.js";import{E as l}from"./mec-B1V75Ai1.js";import{M as c}from"./flowbite-Ln6Jbqyc.js";import"./call-bind-BFQqbmjp.js";import"./@alpinejs/resize-CO1KAvJ_.js";import"./alpinejs-D043VxOM.js";import"./pinecone-router-DyexUCCX.js";import"./posthog-js-CcaH5niV.js";import"./node-polyglot-DlDlDF9m.js";import"./object.entries-DoVD67HD.js";import"./define-properties-JTyBPjo4.js";import"./object-keys-2-4LXbPU.js";import"./define-data-property-Dhkuw5U5.js";import"./es-define-property-BWOk23UV.js";import"./es-errors-CDnSFAF0.js";import"./gopd-DyUmdEtY.js";import"./has-property-descriptors-DsFaFEFP.js";import"./es-object-atoms-DlYjuSOe.js";import"./call-bound-BNSK0NEA.js";import"./get-intrinsic-Cxr_xTZv.js";import"./math-intrinsics-BRbcxSny.js";import"./has-symbols-B2_RGGVc.js";import"./get-proto-BRVA0OAU.js";import"./dunder-proto-DMCSAdn6.js";import"./call-bind-apply-helpers-BSpli2uY.js";import"./function-bind-DR49pCHT.js";import"./hasown-NUnpZb-C.js";import"./warning-Bp1nZ229.js";import"./@sentry/browser-Bk1Xewov.js";import"./@sentry/core-CnjMJUhl.js";import"./@sentry-internal/browser-utils-BUixo4nC.js";import"./@sentry-internal/replay-yt77ihwD.js";import"./set-function-length-BuPlcIl4.js";import"./config.service-YGUPWIw7.js";import"./@popperjs/core-IAo43KLY.js";import"./flowbite-datepicker-D6bDqdY1.js";const h={name:()=>"workOrderNew",template:()=>e((()=>import("./work-order-new-CwLZ1-dL.js")),[]),data:()=>({user:null,nav:null,aside:null,userMec:l,cliente:"",fecdoc:"",newWorkOrder:null,workOrderCliente:null,modalSearchCliente:null,hasSearched:!1,loadingClientes:!1,selectedCliente:null,currentCliente:"",currentRaz:"",currentNom:"",currentCif:"",currentDir:"",clientes:[],clienteMetaData:null,currentPage:1,pageInfo:"",loading:!0,submitting:!1,async init(){console.log("work-order-new@init");try{this.user=await r()}catch(e){location.href="/login?redirect=/or/new"}this.initModalSearchCliente(),this.nav=await n(a),this.aside=await n(o),this.loading=!1,await this.loadUserMec();["currentCliente","currentRaz","currentNom","currentCif","currentDir"].forEach((e=>{this.$watch(e,(()=>{this.hasSearched||(this.hasSearched=!0),1!==this.currentPage&&(this.currentPage=1),this.currentCliente.length<1&&this.currentRaz.length<2&&this.currentNom.length<2&&this.currentCif.length<2&&this.currentDir.length<2&&this.resetValues()}))}))},initModalSearchCliente(){this.modalSearchCliente=new c(this.$refs.modalSearchCliente,{placement:"center",backdrop:"static",backdropClasses:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40",closable:!0,onHide:()=>{console.log("modal is hidden"),this.resetValues(),[this.currentCliente,this.currentRaz,this.currentNom,this.currentCif,this.currentDir]=["","","","",""]},onShow:()=>{console.log("modal is shown")},onToggle:()=>{console.log("modal is toggled")}},{id:"modal-search-cliente",override:!0})},async loadUserMec(){try{const e=await fetch(t(`/isiWeb/web/v1/empresas/01/mecanicos?usuario=${this.user.usuario}`),{credentials:"include",headers:{"Content-Type":"application/json"}});if(404===e.status)throw new Error(this.$t("WORKORDERS.mec_not_found"));if(!e.ok)throw new Error(this.$t(e.statusText));const i=await e.json();this.userMec=i.data[0]}catch(e){this.error=e.message}},async openSearchClienteModal(){var e;""!==this.cliente&&(this.currentCliente=this.cliente,await this.searchCliente()),null==(e=this.modalSearchCliente)||e.show()},resetValues(){this.pageInfo="",this.clientes=[],this.clienteMetaData=null,this.hasSearched=!1,this.loadingClientes=!1},async createWorkOrder(){try{if(this.submitting=!0,!this.selectedCliente)throw new Error(this.$t("CLIENT.not_found"));const e=await fetch(t("/isiWeb/web/v1/empresas/01/ordenes-reparacion"),{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.newWorkOrder,fedoc:this.fecdoc,cif:this.selectedCliente.cif,cli:this.selectedCliente.cli,dir:this.selectedCliente.dir,email:this.selectedCliente.email,mec:this.userMec.mec})});if(!e.ok){const t=await e.json();throw new Error(this.$t(t.message))}const s=await e.json();this.submitting=!1,this.$router.navigate(`/or/${s.data.OR}/details`),this.$dispatch(i,{msg:`Orden de reparaciÃ³n ${s.data.OR} creada correctamente`,level:"success"})}catch(e){console.error(e),this.$dispatch(i,{msg:e,level:s}),this.submitting=!1}},selectCliente(e){this.selectedCliente=e},setFormCliente(){var e;null!==this.selectedCliente&&(this.cliente=this.selectedCliente.cli.toString(),this.workOrderCliente=this.selectedCliente,null==(e=this.modalSearchCliente)||e.hide())},async searchCliente(){const e=this.buildFilter();try{if(""!==e){this.loadingClientes=!0;const i=await fetch(t(`/isiWeb/web/v1/empresas/01/clientes?${e}`),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"});if(!i.ok){const e=await i.json();throw new Error(this.$t(e.message))}const s=await i.json();this.clientes=s.data.slice(0,15),this.clienteMetaData=s.meta;const r=15*(this.currentPage-1)+1,n=Math.min(15*this.currentPage,this.clienteMetaData.rows);this.pageInfo=`Mostrando ${r} a ${n} de ${this.clienteMetaData.rows} registros`,this.loadingClientes=!1}}catch(r){console.error(r),this.$dispatch(i,{msg:r,level:s})}},async buildCliente(e){var r,n;const a=e.target.value;try{if(this.workOrderCliente=null,""!==a){this.loadingClientes=!0;const e=await fetch(t(`/isiWeb/web/v1/empresas/01/clientes/${a}`),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"});if(!e.ok){const t=await e.json();throw this.selectedCliente&&(this.selectedCliente=null),new Error(this.$t(t.message))}const i=await e.json();this.selectedCliente=i.data,this.workOrderCliente=this.selectedCliente,this.clienteMetaData=i.meta,this.loadingClientes=!1}}catch(o){console.error(o),this.$dispatch(i,{msg:o,level:s}),this.loadingClientes=!1,null==(r=this.modalSearchCliente)||r.show(),null==(n=this.$refs.searchClienteInput)||n.focus()}},buildFilter(){let e="";return e=this.appendFilter(e,this.currentCliente,"cli",1),e=this.appendFilter(e,this.currentRaz,"raz",2),e=this.appendFilter(e,this.currentNom,"nom",2),e=this.appendFilter(e,this.currentCif,"cif",2),e=this.appendFilter(e,this.currentDir,"dir",2),e},appendFilter(e,t,i,s){let r=e;return t.length>=s&&(r+=""!==r?"cli"===i?`&${i}:=${t}`:`&${i}:like=${t}`:"cli"===i?`${i}:=${t}`:`${i}:like=${t}`),r}})};export{h as default};
//# sourceMappingURL=work-order-new-D66ioN4m.js.map
