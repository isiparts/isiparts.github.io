try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="bed685b8-c4ed-4b8e-9be1-4dbb5ef9062f",e._sentryDebugIdIdentifier="sentry-dbid-bed685b8-c4ed-4b8e-9be1-4dbb5ef9062f")}catch(b){}import{_ as e,u as t,T as i,b as o,h as s,g as a,k as n,r}from"./index-OdOCjMiI.js";import{n as l,a as d}from"./nav-Ck_lkINx.js";import"./call-bind-BFQqbmjp.js";import{l as c}from"./config.service-YGUPWIw7.js";import{M as p}from"./flowbite-Ln6Jbqyc.js";import"./@alpinejs/resize-CO1KAvJ_.js";import"./alpinejs-D043VxOM.js";import"./pinecone-router-DyexUCCX.js";import"./posthog-js-CcaH5niV.js";import"./node-polyglot-DlDlDF9m.js";import"./object.entries-DoVD67HD.js";import"./define-properties-JTyBPjo4.js";import"./object-keys-2-4LXbPU.js";import"./define-data-property-Dhkuw5U5.js";import"./es-define-property-BWOk23UV.js";import"./es-errors-CDnSFAF0.js";import"./gopd-DyUmdEtY.js";import"./has-property-descriptors-DsFaFEFP.js";import"./es-object-atoms-DlYjuSOe.js";import"./call-bound-BNSK0NEA.js";import"./get-intrinsic-Cxr_xTZv.js";import"./math-intrinsics-BRbcxSny.js";import"./has-symbols-B2_RGGVc.js";import"./get-proto-BRVA0OAU.js";import"./dunder-proto-DMCSAdn6.js";import"./call-bind-apply-helpers-BSpli2uY.js";import"./function-bind-DR49pCHT.js";import"./hasown-NUnpZb-C.js";import"./warning-Bp1nZ229.js";import"./@sentry/browser-Bk1Xewov.js";import"./@sentry/core-CnjMJUhl.js";import"./@sentry-internal/browser-utils-BUixo4nC.js";import"./@sentry-internal/replay-yt77ihwD.js";import"./set-function-length-BuPlcIl4.js";import"./@popperjs/core-IAo43KLY.js";import"./flowbite-datepicker-D6bDqdY1.js";const h={or:"",ejr:-1,sef:"",docum:-1,numDocum:-1,nombre:"",mimeType:"",fecha:"",hora:"",descripcion:"",documento:""},m={cif:"",dup:"",nroenv:-1,raz:"",dir:"",codpos:"",pob:"",pobdes:"",pro:"",prodes:"",pai:"",paides:"",tel1:"",tel2:"",fax:"",email:""},g={name:()=>"presaleEdit",template:()=>e((()=>import("./presale-edit-DWRhtdTN.js")),[]),data:()=>({config:c(),user:null,empresa:null,nav:null,aside:null,loading:!0,submitting:!1,provinciaSelected:null,poblacionSelected:null,actividadSelected:null,tpempSelected:null,codposText:null,presale:null,editedPresale:null,provincias:[],poblaciones:[],ivas:[],modosPago:[],diasPago:[],paises:[],tiposCliente:[],tiposEmpresa:[],vendedores:[],cobradores:[],zonas:[],actividades:[],direccionesEnvio:[],modalShipmentEdit:null,modalShipmentDelete:null,modalShipmentAdd:null,modalValidatePresale:null,modalSepaAdd:null,modalSepaDelete:null,modalSepaView:null,adjuntos:[],loadingPresaleShipmentDetails:!1,loadingSepa:!1,currentShipmentDetails:m,currentAdjunto:h,tabs:[{id:0,text:"Datos de cliente",formRef:"formDatosCliente"},{id:1,text:"Datos de facturación",formRef:"formDatosFacturacion"},{id:2,text:"Clasificación de cliente",formRef:"formClasificacionCliente"},{id:3,text:"Direcciones de envío",formRef:"tableShipmentDetails"},{id:4,text:"Protección de datos",formRef:"formProteccionDatos"}],currentTabId:0,async init(){console.log("presale-edit@init");try{this.user=await a(),this.empresa=await n(this.user.empOmi)}catch(t){location.href="/login"}this.nav=await r(l),this.aside=await r(d),this.initModalAddShipmentDetail(),this.initModalDeleteShipmentDetail(),this.initModalValidatePresale(),this.initModalAddSepa(),this.initModalDeleteSepa(),this.initModalViewSepa(),this.$watch("currentTabId",(async()=>{3===this.currentTabId&&await this.loadShippingDetails(),4===this.currentTabId&&this.loadSepa()}));const e=this.debounce((async()=>{this.assignPoblacionProvincia()}),500);this.$watch("codposText",((t,i)=>{t!==i&&t!==i&&null!==i&&e()})),this.$nextTick((async()=>{console.log("101-presale-edit@nextTick"),await Promise.all([this.loadPresale(),this.loadIvas(),this.loadPaymentModes(),this.loadPaymentDays(),this.loadCountries(),this.loadClientTypes(),this.loadZones(),this.loadCompanyTypes(),this.loadActivities(),this.loadSellers()]),console.log(this.presale,"presale")})),this.loading=!1},debounce(e,t){let i;return(...o)=>{clearTimeout(i),i=setTimeout((()=>{e(...o)}),t)}},initModalAddSepa(){this.$nextTick((()=>{this.modalSepaAdd=new p(this.$refs.modalSepaAdd,{placement:"center",backdrop:"dynamic",backdropClasses:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40",closable:!0,onHide:()=>{console.log("modal is hidden")},onShow:()=>{console.log("modal is shown")},onToggle:()=>{console.log("modal has been toggled")}},{id:"modal-sepa-add",override:!0})}))},initModalDeleteSepa(){this.$nextTick((()=>{this.modalSepaDelete=new p(this.$refs.modalSepaDelete,{placement:"center",backdrop:"dynamic",backdropClasses:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40",closable:!0,onHide:()=>{console.log("modal is hidden")},onShow:()=>{console.log("modal is shown")},onToggle:()=>{console.log("modal has been toggled")}},{id:"modal-sepa-delete",override:!0})}))},initModalViewSepa(){this.$nextTick((()=>{this.modalSepaView=new p(this.$refs.modalSepaView,{placement:"center",backdrop:"dynamic",backdropClasses:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40",closable:!0,onHide:()=>{console.log("modal is hidden")},onShow:()=>{console.log("modal is shown")},onToggle:()=>{console.log("modal has been toggled")}},{id:"modal-sepa-view",override:!0})}))},initModalAddShipmentDetail(){this.$nextTick((()=>{this.modalShipmentAdd=new p(this.$refs.modalShipmentAdd,{placement:"center",backdrop:"static",backdropClasses:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40",closable:!0,onHide:()=>{console.log("modal is hidden")},onShow:()=>{console.log("modal is shown")},onToggle:()=>{console.log("modal has been toggled")}},{id:"modal-shipment-add",override:!0})}))},initModalEditShipmentDetail(){this.$nextTick((()=>{this.modalShipmentEdit=new p(this.$refs.modalShipmentEdit,{placement:"center",backdrop:"static",backdropClasses:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40",closable:!0,onHide:()=>{console.log("modal is hidden")},onShow:()=>{console.log("modal is shown")},onToggle:()=>{console.log("modal has been toggled")}},{id:"modalShipmentEdit",override:!0})}))},initModalDeleteShipmentDetail(){this.$nextTick((()=>{this.modalShipmentDelete=new p(this.$refs.modalShipmentDelete,{placement:"center",backdrop:"dynamic",backdropClasses:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40",closable:!0,onHide:()=>{console.log("modal is hidden")},onShow:()=>{console.log("modal is shown")},onToggle:()=>{console.log("modal has been toggled")}},{id:`modal-shipment-delete-${this.currentShipmentDetails.nroenv}`,override:!0})}))},initModalValidatePresale(){this.$nextTick((()=>{this.modalValidatePresale=new p(this.$refs.modalValidatePresale,{placement:"center",backdrop:"dynamic",backdropClasses:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40",closable:!0,onHide:()=>{console.log("modal is hidden")},onShow:()=>{console.log("modal is shown")},onToggle:()=>{console.log("modal has been toggled")}},{id:"modal-validate-presale",override:!0})}))},openAddSepaModal(){var e;this.$refs.formModalAddSepa.reset(),null==(e=this.modalSepaAdd)||e.show()},openDeleteSepaModal(e){var t;this.currentAdjunto=e,null==(t=this.modalSepaDelete)||t.show()},async openViewSepaModal(e){var t;try{const i=this.$refs.modalSepaViewImage;i.children.length>0&&i.removeChild(i.children[0]);const o=document.createElement("object");o.className="w-auto h-auto max-h-full","application/pdf"===e.mimeType&&(o.className="w-full h-full max-h-full");const s="/sepa.pdf",a=await fetch(s);if(!a.ok)throw new Error(this.$t("PDF Error"));console.log(a),o.data=s,o.type="application/pdf",i.appendChild(o),null==(t=this.modalSepaView)||t.show()}catch(i){console.error(i)}},openAddShipmentDetailModal(){var e;this.provinciaSelected=!1,this.$refs.formModalAddShipment.reset(),null==(e=this.modalShipmentAdd)||e.show()},openValidateModal(){var e;null==(e=this.modalValidatePresale)||e.show()},async openEditShipmentDetailModal(e){var t;this.currentShipmentDetails={...e},await this.loadPoblaciones(this.currentShipmentDetails.pro),null==(t=this.modalShipmentEdit)||t.show()},openDeleteShipmentDetailModal(e){var t;this.currentShipmentDetails=e,null==(t=this.modalShipmentDelete)||t.show()},addSepa(e){var t;this.submitting=!0;const o=e.target,a=new FormData(o).get("file");if(a.size>0){const e=new FileReader;e.onload=e=>{var t,o,n,r;const l=null==(t=e.target)?void 0:t.result,d={or:null==(o=this.workOrder)?void 0:o.OR,ejr:null==(n=this.workOrder)?void 0:n.ejr,sef:null==(r=this.workOrder)?void 0:r.sef,docum:1,numDocum:1,nombre:a.name,mimeType:"application/pdf",fecha:(new Date).toISOString().split("T")[0],hora:(new Date).toISOString().split("T")[1],descripcion:"",documento:l.split(",")[1]};this.adjuntos.push(d),window.localStorage.setItem("isiparts.presale.sepa",JSON.stringify(d)),this.$dispatch(i,{msg:"Documento de protección de datos añadido correctamente",level:s})},e.readAsDataURL(a)}this.submitting=!1,null==(t=this.modalSepaAdd)||t.hide()},deleteSepa(e){var t;try{if(this.submitting=!0,this.adjuntos.includes(e)){const i=this.adjuntos.indexOf(e);this.adjuntos.splice(i,1),null==(t=this.modalSepaDelete)||t.hide()}this.submitting=!1,this.$dispatch(i,{msg:"Documento de protección de datos eliminado correctamente",level:s})}catch(a){console.error(a),this.submitting=!1,this.$dispatch(i,{msg:a,level:o})}},loadSepa(){if(this.loadingSepa=!0,window.localStorage.getItem("isiparts.presale.sepa")){const e=JSON.parse(window.localStorage.getItem("isiparts.presale.sepa")??"{}");this.adjuntos.push(e)}setTimeout((()=>{this.loadingSepa=!1}),1e3)},submitFormByEvent(e){var t;console.log("submitFormByEvent",null==(t=e.submitter)?void 0:t.innerText),e.preventDefault();const i=e.target;this.submitForm(i)},submitForm(e){const t=new FormData(e),i=Object.fromEntries(t.entries());this.editedPresale={...this.editedPresale,...i},console.log(this.editedPresale)},submitFormByRef(e,t){if("tableShipmentDetails"!==e&&"formProteccionDatos"!==e){const t=this.$refs[e];if(!t.checkValidity())return void t.reportValidity();this.submitForm(t)}this.currentTabId=t},async savePresale(){try{this.submitting=!0;const e=await fetch(t(`isiWeb/web/v1/empresas/01/presuntos/${this.$params.pre}`),{credentials:"include",method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.editedPresale,pro:this.provinciaSelected,pob:this.poblacionSelected,prodes:this.editedPresale.prodes,pobdes:this.editedPresale.pobdes,codpos:this.codposText,perfac:+this.editedPresale.perfac,rietotcon:+this.editedPresale.rietotcon,ivc:"true"===this.editedPresale.ivc,abf:"on"===this.editedPresale.abf,enviarfacturaelectronica:"on"===this.editedPresale.enviarfacturaelectronica,enviarfacturaemail:"on"===this.editedPresale.enviarfacturaemail,cobrador:+this.editedPresale.cobrador,tpemp:this.tpempSelected,"acti[1]":this.actividadSelected})});if(!e.ok){const t=await e.json();throw new Error(this.$t(t.message))}const o=await e.json();this.$router.navigate("/potencial/list"),this.$dispatch(i,{msg:o.message,level:s})}catch(e){console.error(e),this.submitting=!1,this.$dispatch(i,{msg:e,level:o})}},async addShipmentDetails(e){var a,n,r;const l=new FormData(e.target),d=Object.fromEntries(l.entries()),c={cif:null==(a=this.presale)?void 0:a.cif,dup:null==(n=this.presale)?void 0:n.dup,...d};this.submitting=!0;try{const e=await fetch(t(`isiWeb/web/v1/empresas/01/presuntos/${this.$params.pre}/direcciones-envio`),{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!e.ok){const t=await e.json();throw new Error(this.$t(t.message))}await this.loadShippingDetails(),null==(r=this.modalShipmentAdd)||r.hide(),this.$dispatch(i,{msg:"Dirección de envío añadida",level:s})}catch(p){console.error(p),this.$dispatch(i,{msg:p,level:o})}this.submitting=!1},async editShipmentDetails(e){var a;const n=new FormData(e.target),r=Object.fromEntries(n.entries());try{this.submitting=!0;const e=await fetch(t(`isiWeb/web/v1/empresas/01/presuntos/${this.$params.pre}/direcciones-envio/${this.currentShipmentDetails.nroenv}`),{credentials:"include",method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.currentShipmentDetails,...r})});if(!e.ok){const t=await e.json();throw new Error(this.$t(t.message))}await this.loadShippingDetails(),this.currentShipmentDetails=m,null==(a=this.modalShipmentEdit)||a.hide(),this.submitting=!1,this.$dispatch(i,{msg:"Dirección de envío actualizada",level:s})}catch(l){console.error(l),this.submitting=!1,this.$dispatch(i,{msg:l,level:o})}},async validatePresale(){var e,a;this.submitting=!0;const n=`${(new Date).getFullYear()}-${(new Date).getMonth()+1}-${(new Date).getDate()}`;try{const o=await fetch(t(`isiWeb/web/v1/empresas/01/presuntos/${this.$params.pre}`),{credentials:"include",method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.presale,conf:!0,fecconf:n,usuconf:null==(e=this.user)?void 0:e.usuario})});if(!o.ok){const e=await o.json();throw new Error(this.$t(e.message))}const r=await o.json();null==(a=this.modalValidatePresale)||a.hide(),this.submitting=!1,this.$router.navigate("/potencial/list"),this.$dispatch(i,{msg:r.message,level:s})}catch(r){console.error(r),this.submitting=!1,this.$dispatch(i,{msg:r,level:o})}},async deleteShipmentDetail(e){var a;this.submitting=!0;try{const o=await fetch(t(`isiWeb/web/v1/empresas/01/presuntos/${this.$params.pre}/direcciones-envio/${e.nroenv}`),{credentials:"include",headers:{"Content-Type":"application/json"},method:"DELETE"});if(!o.ok){const e=await o.json();throw new Error(this.$t(e.message))}await this.loadShippingDetails(),this.currentShipmentDetails=m,null==(a=this.modalShipmentDelete)||a.hide(),this.$dispatch(i,{msg:"Dirección de envío eliminada",level:s})}catch(n){console.log("error",n),this.$dispatch(i,{msg:n,level:o})}this.submitting=!1},async loadPresale(){try{const e=await fetch(t(`isiWeb/web/v1/empresas/01/presuntos/${this.$params.pre}`),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),i=await e.json();if(!e.ok)throw new Error(this.$t("Error loading presale"));this.presale=i.data,this.codposText=this.presale.codpos,this.editedPresale={...this.presale},await this.loadProvincias()}catch(e){console.error(e)}},async loadProvincias(){var e,i;try{const o=await fetch(t("isiWeb/web/v1/provincias"),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),s=await o.json();if(!o.ok)throw new Error(this.$t("Error loading provincias"));if(this.provincias=s.data,(null==(e=this.presale)?void 0:e.pro)||(this.provinciaSelected=""),null==(i=this.presale)?void 0:i.pro){const e=this.provincias.find((e=>{var t;return e.pro===(null==(t=this.presale)?void 0:t.pro)}));this.provinciaSelected=null==e?void 0:e.pro,e&&await this.loadPoblaciones(e.pro)}}catch(o){console.error(o)}},async assignPoblacionProvincia(){var e,s;console.log("entramos");try{const i=await fetch(t(`/isiWeb/web/v1/poblaciones?codpos=${this.codposText}`),{credentials:"include",method:"GET"});if(!i.ok)throw new Error(i.statusText);const o=(await i.json()).data,a=o[0].pro;this.provinciaSelected!==a&&(this.provinciaSelected=a,this.editedPresale.prodes=null==(e=this.provincias.find((e=>e.pro===a)))?void 0:e.prodes,await this.loadPoblaciones(this.provinciaSelected)),this.poblacionSelected=null==(s=o.find((e=>e.codpos===this.codposText)))?void 0:s.pob}catch(a){this.$dispatch(i,{msg:a.message,level:o}),console.error(a)}},loadPoblacionCodpos(){var e;const t=null==(e=this.poblaciones.find((e=>e.pob===this.poblacionSelected)))?void 0:e.codpos;t&&(this.codposText=t)},async loadPoblaciones(e){var i,o,s;try{const a=await fetch(t(`isiWeb/web/v1/poblaciones?pro=${e}`),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),n=await a.json();if(!a.ok)throw new Error(this.$t("Error loading poblaciones"));this.poblaciones=n.data,(null==(i=this.presale)?void 0:i.pob)||(this.poblacionSelected=""),(null==(o=this.presale)?void 0:o.pob)&&!this.poblacionSelected&&(this.poblacionSelected=null==(s=this.presale)?void 0:s.pob);const r=this.poblaciones.find((e=>e.codpos===this.codposText));""!==this.poblacionSelected&&(null==r?void 0:r.codpos)!==this.codposText&&(this.poblacionSelected=this.poblaciones[0].pob,this.codposText=this.poblaciones[0].codpos)}catch(a){console.error(a)}},async loadIvas(){try{const e=await fetch(t("isiWeb/web/v1/ivas"),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),i=await e.json();if(!e.ok)throw new Error(this.$t("Error loading ivas"));this.ivas=i.data}catch(e){console.error(e)}},async loadPaymentModes(){try{const e=await fetch(t("isiWeb/web/v1/empresas/01/modos-pago"),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),i=await e.json();if(!e.ok)throw new Error(this.$t("Error loading payment modes"));this.modosPago=i.data}catch(e){console.error(e)}},async loadPaymentDays(){try{const e=await fetch(t("isiWeb/web/v1/empresas/01/dias-pago"),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),i=await e.json();if(!e.ok)throw new Error(this.$t("Error loading payment days"));this.diasPago=i.data}catch(e){console.error(e)}},async loadCountries(){try{const e=await fetch(t("isiWeb/web/v1/paises"),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),i=await e.json();if(!e.ok)throw new Error(this.$t("Error loading countries"));this.paises=i.data}catch(e){console.error(e)}},async loadClientTypes(){try{const e=await fetch(t("isiWeb/web/v1/empresas/01/tipos-cliente"),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),i=await e.json();if(!e.ok)throw new Error(this.$t("Error loading client types"));this.tiposCliente=i.data}catch(e){console.error(e)}},async loadZones(){try{const e=await fetch(t("isiWeb/web/v1/empresas/01/zonas"),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),i=await e.json();if(!e.ok)throw new Error(this.$t("Error loading zones"));this.zonas=i.data}catch(e){console.error(e)}},async loadCompanyTypes(){var e,i;try{const o=await fetch(t("isiWeb/web/v1/tipos-empresa"),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),s=await o.json();if(!o.ok)throw new Error(this.$t("Error loading company types"));this.tiposEmpresa=s.data,(null==(e=this.presale)?void 0:e.tpemp)&&(this.tpempSelected=null==(i=this.presale)?void 0:i.tpemp)}catch(o){console.error(o)}},async loadActivities(){try{const e=await fetch(t("isiWeb/web/v1/actividades"),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),i=await e.json();if(!e.ok)throw new Error(this.$t("Error loading activities"));this.actividades=i.data,this.presale["acti[1]"]&&(this.actividadSelected=this.presale["acti[1]"])}catch(e){console.error(e)}},async loadSellers(){try{const e=await fetch(t("isiWeb/web/v1/empresas/01/vendedores"),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),i=await e.json();if(!e.ok)throw new Error(this.$t("Error loading sellers"));this.vendedores=i.data,this.cobradores={...this.vendedores}}catch(e){console.error(e)}},async loadShippingDetails(){this.loadingPresaleShipmentDetails=!0;try{const e=await fetch(t(`isiWeb/web/v1/empresas/01/presuntos/${this.$params.pre}/direcciones-envio`),{credentials:"include",headers:{"Content-Type":"application/json"},method:"GET"}),i=await e.json();if(!e.ok)throw new Error(this.$t("Error loading shipping details"));this.direccionesEnvio=i.data}catch(e){console.error(e)}this.loadingPresaleShipmentDetails=!1}})};export{g as default};
//# sourceMappingURL=presale-edit-DR1DpPJf.js.map
