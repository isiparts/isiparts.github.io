try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="9c6ad5fd-939d-4ccb-9f01-bac654a0a080",e._sentryDebugIdIdentifier="sentry-dbid-9c6ad5fd-939d-4ccb-9f01-bac654a0a080")}catch($){}function e(e){if("template"!==e.tagName.toLowerCase())throw new TypeError("Directives can only be used on template elements.")}function t(t){if(e(t),void 0===t._x_PineconeRouter_route)throw new TypeError((e=>`x-${e} must be used on the same template as x-route`)("template"))}function n(e){if("object"!=typeof e||!Array.isArray(e))throw new TypeError((e=>`Invalid expression type. Expression: ${e}`)(e))}var r={hash:!1,basePath:"",globalHandlers:[],handleClicks:!0,targetID:void 0,preload:!1,fetchOptions:{}},a=e=>("notfound"==e||e.startsWith(r.basePath)||(e=r.basePath+e),e),o=e=>/^\[.*\]$|^Array\(.*\)$/.test(e.trim()),i=new Set,s=new Map,l=new Map,d=new Set,u=(e,t)=>{document.dispatchEvent(new CustomEvent("pinecone:fetch-error",{detail:{error:e,url:t}}))},h=(e,t,n,r,a)=>{let o=t.id+n;if(i.has(o))return;i.add(o);let s=t.content,l=Array(s.childElementCount);s.querySelectorAll("script").forEach((e=>{var t;let n=document.createElement("script");Array.from(e.attributes).forEach((e=>n.setAttribute(e.name,e.value))),n.textContent=e.textContent,null==(t=e.parentNode)||t.replaceChild(n,e)}));let d=Array.from(s.children);for(let i=0;i<d.length;i++)l[i]=d[i].cloneNode(!0),e.addScopeToNode(l[i],{},t);e.mutateDom((()=>{r?r.replaceChildren(...l):t.after(...l),l.forEach((t=>{e.initTree(t)}))})),t._x_PineconeRouter_template=l,t._x_PineconeRouter_templateUrls=a,t._x_PineconeRouter_undoTemplate=()=>{e.mutateDom((()=>{l.forEach((t=>{e.destroyTree(t),t.remove()}))})),delete t._x_PineconeRouter_template},e.nextTick((()=>i.delete(o)))},c=e=>{e._x_PineconeRouter_undoTemplate&&(e._x_PineconeRouter_undoTemplate(),delete e._x_PineconeRouter_undoTemplate)},p=(e,t)=>e.map((e=>e.replace(/:([^/.]+)/g,((e,n)=>t[n]||n)))),f=async(e,t="high")=>{if(e=a(e),s.has(e))return s.get(e);if(l.has(e))return l.get(e);let n=fetch(e,{...r.fetchOptions,priority:t}).then((t=>t.ok?t.text():(u(t.statusText,e),""))).then((t=>(t&&s.set(e,t),l.delete(e),t||""))).catch((t=>(t instanceof TypeError&&u(t.message,e),"")));return l.set(e,n),n},m=(e,t)=>{d.add({urls:e,el:t})},g=()=>{for(let e of d)e.el?_(e.urls,e.el,"low"):e.urls.map((e=>f(e,"low"))),d.delete(e)},_=(e,t,n="high")=>Promise.all(e.map((e=>f(e,n)))).then((e=>{t.innerHTML=e.join("")})),x=(e,a)=>{e.directive("template",((e,{expression:i,modifiers:s},{evaluate:l,cleanup:d,Alpine:u,effect:f})=>{t(e);let g,x=((e,t)=>{let n=e??t??"",r=document.getElementById(n);if(n&&!r)throw new ReferenceError((e=>`Can't find an element with target ID: ${e}`)(n));return r??void 0})(((e,t,n)=>{if(-1===e.indexOf(t))return n;let r=e[e.indexOf(t)+1];if(!r)return n;{let e=r.match(/([a-z0-9_-]+)/);if(e)return e[1]}return r})(s,"target"),r.targetID),y=e._x_PineconeRouter_route,w=s.includes("interpolate");if(""!=i){o(i)||(i=`['${i}']`);let t=l(i);n(t),g=t,w||!r.preload&&!s.includes("preload")||m(g,e),a.routes.get(y).templates=g}let b=t=>{var n;(null==(n=a.context.route)?void 0:n.path)===y?(t&&w&&(t=p(t,a.context.params)),(async(e,t,n,r,a)=>{if(null!=t._x_PineconeRouter_templateUrls&&t._x_PineconeRouter_templateUrls!=r&&(c(t),t.innerHTML=""),!t._x_PineconeRouter_template){if(!t.content.childElementCount)return r?_(r,t).then((()=>h(e,t,n,a,r))):void 0;h(e,t,n,a,r)}})(u,e,i,t,x).then((()=>{a.loading=!1}))):c(e)},v=f((()=>b(g)));d((()=>{e._x_PineconeRouter_undoTemplate&&e._x_PineconeRouter_undoTemplate(),u.release(v)}))}))},y=(e,a)=>{e.directive("handler",((i,{expression:s,modifiers:l},{evaluate:d,cleanup:u})=>{o(s)||(s=`[${s}]`);let h=d(s);n(h);let c,p=h;for(let t=0;t<p.length;t++)p[t]=p[t].bind(e.$data(i));if(l.includes("global"))r.globalHandlers=p;else{t(i);let e=i._x_PineconeRouter_route;c=a.routes.get(e),c.handlers=p}u((()=>{l.includes("global")?r.globalHandlers=[]:c.handlers=[]}))})).before("template")},w=(t,n)=>{t.directive("route",((t,{expression:o,value:i},{cleanup:s})=>{let l=r.hash?o:a(o);e(t),"notfound"!=l&&n.add(l,{name:i}),t._x_PineconeRouter_route=l,s((()=>{n.routes.delete(l),delete t._x_PineconeRouter_route}))})).before("handler")},b=()=>({entries:[],index:0,canGoBack:function(){return this.index>0},back:function(){this.to(this.index-1)},canGoForward:function(){return this.index<this.entries.length-1},forward:function(){this.to(this.index+1)},to:function(e){var t;e in this.entries&&(null==(t=this.router)||t.navigate(this.entries[e],!1,!1,e))},push:function(e,t){this.index<this.entries.length-1&&(this.entries=this.entries.slice(0,this.index+1)),this.entries.push(e),this.index=this.entries.length-1,t&&this.pushState(e)},pushState:function(e){let t=r.hash&&!e.startsWith("#")?"#"+e:e,n={path:t};history.pushState(n,"",t)},setRouter(e){this.router=e}});function v(e){let t=e.split("/").filter(Boolean).map((e=>{if(!e.startsWith(":"))return"/"+e;let[,t,n,r]=e.match(/^:(\w+)([?+*]?)(?:\.(.+))?$/)||[],a="?"===n||"*"===n,o=`(?<${t}>${"*"===n||"+"===n?a?".*?":".+":"[^/]+?"})`+(r?`\\.${r}`:"");return a?`(?:/${o})?`:`/${o}`})).join("");return new RegExp(`^${t}/?$`,"i")}var E=(e,{targetID:t,templates:n=[],handlers:r=[],interpolate:a=!1,name:o}={})=>({programmaticTemplates:n.length>0,pattern:v(e),interpolate:a,templates:n,targetID:t,handlers:r,name:o||e,path:e,match(e){let t=this.pattern.exec(e);if(t)return{...t.groups}}}),P=(e,t,n)=>({path:e,params:t,route:n});var R=(e,t,n)=>{let o=E("notfound",{handlers:[e=>console.error(new ReferenceError((e=>`Path: ${e} was not found`)(e.path)))],name:"notfound"}),i=new Map([["notfound",o]]),s=P(n,{}),l=null,d=!1,u={name:e,version:t,history:b(),routes:i,context:s,get loading(){return d},set loading(e){d!=e&&(d=e,document.dispatchEvent(new Event(e?"pinecone:start":"pinecone:end")))},settings:e=>(e=>r={...r,...e})(e),add:function(e,t){if("notfound"!=e&&(r.hash||(e=a(e)),this.routes.has(e)))throw new Error((e=>`Route already exists: ${e}`)(e));t.templates&&(r.preload||t.preload)&&m(t.templates),this.routes.set(e,E(e,t))},remove:function(e){this.routes.delete(e)},navigate:async function(e,t,n,o){l&&l.abort(),l=new AbortController,this.loading=!0,e=e||"/",r.hash||(e=a(e));let i=this.routes.get("notfound"),s={};for(let[r,a]of this.routes){let t=a.match(e);if(t){s=t,i=a;break}}let d=P(e,s,i),h=r.globalHandlers.concat(i.handlers);if(h.length){try{await async function(e,t,n){let r;return new Promise((async(a,o)=>{n.signal.addEventListener("abort",(()=>o()));for(let i of e){if(n.signal.aborted)return;let e={...t,data:r};try{r=await i(e,n)}catch(u){o(u)}}a()}))}(h,d,l)}catch(c){return void(this.loading=!1)}i.templates||(this.loading=!1)}if(null!=o?(this.history.index=o,this.history.pushState(e)):(n||e!=this.context.path)&&this.history.push(e,!t&&!n),this.context=d,i.programmaticTemplates){let e=document.getElementById(i.targetID??r.targetID??"");if(!e)throw new Error("targetID must be specified for programmatically added templates");let t=i.interpolate?p(i.templates,s):i.templates;_(t,e).finally((()=>this.loading=!1))}i.templates.length||(this.loading=!1)}};return u.history.setRouter(u),u},T=function(e){let t=()=>r.hash?location.hash.substring(1):location.pathname,n=e.reactive(R("pinecone-router","7.1.0",t()));window.PineconeRouter=n,document.addEventListener("alpine:initialized",(()=>{n.navigate(t(),!1,!0)})),window.addEventListener("popstate",(()=>{n.navigate(r.hash?window.location.hash.substring(1):window.location.pathname,!0)})),(e=>{window.document.body.addEventListener("click",(t=>{if(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button||t.defaultPrevented)return;let n=t.target.closest("a");if(!n)return;if(!1===r.handleClicks&&!n.hasAttribute("x-link")||n.hasAttribute("data-native")||n.hasAttribute("native"))return;let a=n.getAttribute("href"),o=n.getAttribute("target");!a||o&&!/^_?self$/i.test(o)||(e.navigate(a),t.preventDefault())}))})(n),document.addEventListener("pinecone:end",(()=>e.nextTick(g)),{once:!0}),x(e,n),y(e,n),w(e,n),e.$router=n,e.magic("router",(()=>n)),e.magic("history",(()=>n.history)),e.magic("params",(()=>n.context.params))};export{T as Y};
//# sourceMappingURL=pinecone-router-DyexUCCX.js.map
