try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="233db391-ab59-4e62-bb46-b408beeac76b",e._sentryDebugIdIdentifier="sentry-dbid-233db391-ab59-4e62-bb46-b408beeac76b")}catch(n){}import{_ as e,u as t,g as r,r as s}from"./index-OdOCjMiI.js";import{n as o,a}from"./nav-Ck_lkINx.js";import"./call-bind-BFQqbmjp.js";import"./@alpinejs/resize-CO1KAvJ_.js";import"./alpinejs-D043VxOM.js";import"./pinecone-router-DyexUCCX.js";import"./posthog-js-CcaH5niV.js";import"./node-polyglot-DlDlDF9m.js";import"./object.entries-DoVD67HD.js";import"./define-properties-JTyBPjo4.js";import"./object-keys-2-4LXbPU.js";import"./define-data-property-Dhkuw5U5.js";import"./es-define-property-BWOk23UV.js";import"./es-errors-CDnSFAF0.js";import"./gopd-DyUmdEtY.js";import"./has-property-descriptors-DsFaFEFP.js";import"./es-object-atoms-DlYjuSOe.js";import"./call-bound-BNSK0NEA.js";import"./get-intrinsic-Cxr_xTZv.js";import"./math-intrinsics-BRbcxSny.js";import"./has-symbols-B2_RGGVc.js";import"./get-proto-BRVA0OAU.js";import"./dunder-proto-DMCSAdn6.js";import"./call-bind-apply-helpers-BSpli2uY.js";import"./function-bind-DR49pCHT.js";import"./hasown-NUnpZb-C.js";import"./warning-Bp1nZ229.js";import"./@sentry/browser-Bk1Xewov.js";import"./@sentry/core-CnjMJUhl.js";import"./@sentry-internal/browser-utils-BUixo4nC.js";import"./@sentry-internal/replay-yt77ihwD.js";import"./set-function-length-BuPlcIl4.js";import"./config.service-YGUPWIw7.js";import"./flowbite-Ln6Jbqyc.js";import"./@popperjs/core-IAo43KLY.js";import"./flowbite-datepicker-D6bDqdY1.js";const i={name:()=>"workOrders",template:()=>e((()=>import("./work-order-list-CF4mknD1.js")),[]),data:()=>({user:null,nav:null,aside:null,loading:!0,totalWorkOrders:[],workOrders:[],countTodayWorkOrders:-1,countYesterdayWorkOrders:0,percentageSinceYesterday:-1,countTotalWorkOrders:-1,countPendingWorkOrders:-1,countClosedWorkOrders:-1,progressPercentage:0,currentTab:0,async init(){console.log("work-order-list@init");try{this.user=await r()}catch(e){location.href="/login?redirect=/or/list"}this.nav=await s(o),this.aside=await s(a),await this.loadWorkOrders()},async loadWorkOrders(){var e,r;this.loading=!0;try{if("/or/me"===(null==(e=this.$router.context.route)?void 0:e.name)){const e=await fetch(t(`/isiWeb/web/v1/empresas/01/mecanicos?usuario=${this.user.usuario}`),{credentials:"include",headers:{"Content-Type":"application/json"}}),r=`/isiWeb/web/v1/empresas/01/ordenes-reparacion?mec=${(await e.json()).data[0].mec}`;let s="";switch(this.currentTab){case 0:s=r;break;case 1:s=`${r}&fecrep:eq=`;break;case 2:s=`${r}&fecrep:ne=`}const o=await fetch(t(s),{credentials:"include",headers:{"Content-Type":"application/json"}}),a=(await o.json()).data;this.workOrders=a}if("/or/list"===(null==(r=this.$router.context.route)?void 0:r.name)){const e=`/isiWeb/web/v1/empresas/01/ordenes-reparacion?almnro=${this.user.usuario}`;let r="";switch(this.currentTab){case 0:r=e;break;case 1:r=`${e}&fecrep:eq=`;break;case 2:r=`${e}&fecrep:ne=`}const s=await fetch(t(r),{credentials:"include",headers:{"Content-Type":"application/json"}}),o=(await s.json()).data;this.workOrders=o,0===this.currentTab&&(this.totalWorkOrders=o),await this.loadKpis()}}catch(s){this.error=s.message}this.loading=!1},async loadKpis(){const t=(new Date).toISOString().split("T")[0],r=new Date;r.setDate(r.getDate()-1);const s=r.toISOString().split("T")[0];this.countTodayWorkOrders=this.totalWorkOrders.filter((e=>null===e.fecrep&&e.fedoc===t)).length,this.countYesterdayWorkOrders=this.totalWorkOrders.filter((e=>null===e.fecrep&&e.fedoc===s)).length,this.percentageSinceYesterday=this.countYesterdayWorkOrders>0?Math.round((this.countTodayWorkOrders-this.countYesterdayWorkOrders)/this.countYesterdayWorkOrders*100):0,this.countTotalWorkOrders=this.totalWorkOrders.length,this.countPendingWorkOrders=this.totalWorkOrders.filter((e=>null===e.fecrep)).length,this.countClosedWorkOrders=this.totalWorkOrders.filter((e=>null!==e.fecrep)).length,this.progressPercentage=this.countTotalWorkOrders>0?Math.round((this.countTotalWorkOrders-this.countPendingWorkOrders)/this.countTotalWorkOrders*100):0,console.log("before chart");const o=this.totalWorkOrders.reduce(((e,t)=>{if(!t.fedoc)return e;const r=t.fedoc;return e[r]=(e[r]||0)+1,e}),{}),a=Object.keys(o).sort(((e,t)=>new Date(e).getTime()-new Date(t).getTime())),i=a.map((e=>{const t=new Date(e),r=t.getMonth()+1;return`${t.getDate()}/${r<10?"0":""}${r}/${t.getFullYear()}`})),n=a.map((e=>o[e]));console.log("categories and data",{categories:i,data:n});const d={chart:{height:"100%",maxWidth:"100%",type:"area",fontFamily:"Inter, sans-serif",dropShadow:{enabled:!1},toolbar:{show:!1}},tooltip:{enabled:!0,x:{show:!1}},fill:{type:"gradient",gradient:{opacityFrom:.55,opacityTo:0,shade:"#ed772d",gradientToColors:["#ed772d"]}},dataLabels:{enabled:!1},stroke:{width:6},grid:{show:!1,strokeDashArray:4,padding:{left:2,right:2,top:0}},series:[{name:"OR",data:n,color:"#ed772d"}],xaxis:{categories:i,labels:{show:!1},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{show:!1}},c=document.getElementById("area-chart");if(c){new(0,(await e((async()=>{const{default:e}=await import("./apexcharts-D0pYLWDN.js");return{default:e}}),[])).default)(c,d).render()}},async changeTab(){await this.loadWorkOrders()}})};export{i as default};
//# sourceMappingURL=work-order-list-15sqdva8.js.map
